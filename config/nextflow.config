// 基础配置文件

// 进程资源配置
process {
    // 默认配置
    cpus = 1
    memory = '2 GB'
    // 移除时间限制，允许长时间运行
    
    // 错误处理
    errorStrategy = { task.exitStatus in [143,137,104,134,139] ? 'retry' : 'finish' }
    maxRetries = 3
    maxErrors = '-1'
    
    
    // 计算密集型process的资源配置
    withName: 'prepare_star_index' {
        cpus = 8
        memory = '32 GB'
        // 索引构建可能需要很长时间，不设时间限制
    }
    
    withName: 'run_quality_control' {
        cpus = 8
        memory = '16 GB'
        // 大型文件质控时间不限制
    }
    
    withName: 'run_alignment' {
        cpus = 8
        memory = '32 GB'
        // 序列比对可能需要很长时间，不设时间限制
    }
    
    withName: 'run_quantification' {
        cpus = 8
        memory = '16 GB'
        // 基因定量时间不限制
    }
    
    // 数据准备process的资源配置
    withName: 'prepare_genome_data' {
        cpus = 2
        memory = '4 GB'
        // 基因组下载时间不限制
    }
    
    // 并行下载进程配置
    withName: 'download_genome_fasta' {
        cpus = 2
        memory = '4 GB'
        // FASTA下载时间不限制
    }
    
    withName: 'download_genome_gtf' {
        cpus = 2
        memory = '4 GB'
        // GTF下载时间不限制
    }
    
    withName: 'prepare_local_genome' {
        cpus = 1
        memory = '2 GB'
        // 本地文件准备时间不限制
    }
}

// 执行配置
executor {
    // 使用本地执行器，在容器内直接运行
    name = 'local'
}

// 报告配置 - 输出纯文本格式便于解析
report {
    enabled = true
    file = 'reports/execution_report.txt'
    overwrite = true
}

timeline {
    enabled = true
    file = 'reports/execution_timeline.txt'
    overwrite = true
}

// 添加文本格式的执行日志
trace {
    enabled = true
    file = 'reports/execution_trace.txt'
    overwrite = true
}