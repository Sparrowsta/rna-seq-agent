// 基础配置文件

// 进程资源配置
process {
    // 默认配置
    cpus = 1
    memory = '2 GB'
    time = '1h'
    
    // 错误处理
    errorStrategy = { task.exitStatus in [143,137,104,134,139] ? 'retry' : 'finish' }
    maxRetries = 3
    maxErrors = '-1'
    
    // 输出配置
    publishDir = [
        path: { "${params.outdir}/${task.process.tokenize(':')[-1].tokenize('_')[0].toLowerCase()}" },
        mode: 'copy',
        saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
    ]
    
    // 计算密集型process的资源配置
    withName: 'prepare_star_index' {
        cpus = 8
        memory = '32 GB'
        time = '4h'
    }
    
    withName: 'run_quality_control' {
        cpus = 8
        memory = '16 GB'
        time = '2h'
    }
    
    withName: 'run_alignment' {
        cpus = 8
        memory = '32 GB'
        time = '6h'
    }
    
    withName: 'run_quantification' {
        cpus = 8
        memory = '16 GB'
        time = '2h'
    }
    
    // 数据准备process的资源配置
    withName: 'DOWNLOAD_SRR|LINK_LOCAL_FASTQ' {
        cpus = 4
        memory = '8 GB'
        time = '3h'
    }
    
    withName: 'prepare_genome_data' {
        cpus = 2
        memory = '4 GB'
        time = '2h'
    }
}

// 容器配置
singularity {
    enabled = false
    autoMounts = true
}

docker {
    enabled = false
    userEmulation = true
}

// 调试配置
debug {
    cleanup = false
}